{% set image_token = '<|image_1|>' %}

{% for message in messages %}
    {% if message['type'] == 'text' %}
        {{'<|' + message['role'] + '|>' + '\n' + message['content'] + '<|end|>\n' }}
    {% elif message['type'] in ('image_path','image_url','image_binary') %}
        {{'<|' + message['role'] + '|>' + '\n' + image_token + '<|end|>\n' }}
    {% endif %}
{% endfor %}

{% if add_generation_prompt and messages[-1]['role'] != 'assistant' %}
    {{- '<|assistant|>\n' -}}
{% endif %}",
